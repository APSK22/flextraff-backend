name: ðŸ” Code Quality (Manual)

on:
  workflow_dispatch:
    inputs:
      check_type:
        description: 'Type of quality check to run'
        required: true
        default: 'all'
        type: choice
        options:
        - all
        - formatting
        - linting
        - type-check

jobs:
  code-quality:
    name: ðŸ” Code Quality Checks
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout Code
      uses: actions/checkout@v4

    - name: ðŸ Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: "3.11"

    - name: ðŸ”§ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install black isort flake8 mypy

    - name: ðŸŽ¨ Check Code Formatting (Black)
      if: github.event.inputs.check_type == 'all' || github.event.inputs.check_type == 'formatting'
      run: |
        echo "ðŸŽ¨ Running Black formatter check..."
        black --check --diff app/ tests/ main.py || echo "âŒ Formatting issues found"

    - name: ðŸ“¦ Check Import Sorting (isort)
      if: github.event.inputs.check_type == 'all' || github.event.inputs.check_type == 'formatting'
      run: |
        echo "ðŸ“¦ Running isort import sorting check..."
        isort --check-only --diff app/ tests/ main.py || echo "âŒ Import sorting issues found"

    - name: ðŸ” Lint Code (flake8)
      if: github.event.inputs.check_type == 'all' || github.event.inputs.check_type == 'linting'
      run: |
        echo "ðŸ” Running flake8 linting..."
        flake8 app/ tests/ main.py --statistics || echo "âŒ Linting issues found"

    - name: ðŸ·ï¸ Type Check (mypy)
      if: github.event.inputs.check_type == 'all' || github.event.inputs.check_type == 'type-check'
      run: |
        echo "ðŸ·ï¸ Running mypy type checking..."
        mypy app/ main.py --ignore-missing-imports || echo "âŒ Type checking issues found"

    - name: ðŸ”§ Auto-fix Instructions
      if: always()
      run: |
        echo "## ðŸ”§ To fix code quality issues locally:" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Format code:" >> $GITHUB_STEP_SUMMARY
        echo '```bash' >> $GITHUB_STEP_SUMMARY
        echo "black ." >> $GITHUB_STEP_SUMMARY
        echo "isort ." >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Check linting:" >> $GITHUB_STEP_SUMMARY
        echo '```bash' >> $GITHUB_STEP_SUMMARY
        echo "flake8 app/ tests/ main.py --statistics" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY